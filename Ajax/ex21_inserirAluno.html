<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Inserir Aluno Banco de Dados - AJAX</title>
  <script>
    function mostraInfo(strUF) {
      console.log(strUF);
      if (strUF.length > 0) {
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            //document.getElementById("resposta").value = this.responseText;
            console.log(this.responseText);
            let cidades = JSON.parse(this.responseText);
            let cities = document.getElementById("cidades");
            //let city = new Option(this.responseText, this.responseText);
            //cities.options.add(city);

            cities.length = 0;
            for (cidade of cidades) {
              let city = new Option(cidade.nome);

              cities.options.add(city);
            }
          }
        }
        xmlHttp.open("GET", "http://127.3.3.3/ex20_GetCidades.php?estado=" + strUF, true);
        xmlHttp.send();
        console.log("requisição enviada");
      }
    }

    function inserirAluno() {
      let objAluno = document.getElementById("formAluno");
      let msg = validarAluno(objAluno);
      if (msg == "") {
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            //let obj = JSON.parse(this.responseText);
            document.getElementById("resposta").innerHTML = this.responseText;
          }
        }

        xmlHttp.open("GET", "http://127.3.3.3/ex21_inserirAluno.php?nome=" + objAluno.nome.value +
          "&email=" + objAluno.email.value +
          "&cpf=" + objAluno.cpf.value +
          "&matricula=" + objAluno.matricula.value +
          "&uf=" + objAluno.uf.value +
          "&cidades=" + objAluno.cidades.value, true);
        xmlHttp.send();
        console.log("requisição enviada");
      }

    }
    function validarAluno(Aluno) {
      return "";
    }
  </script>
</head>

<body>
  <h3>Inserir Aluno Banco de Dados - AJAX</h3>
  <form action="" method="GET" name="Aluno" id="formAluno">
    Nome: <input type="text" name="nome"> <br><br>
    Email: <input type="text" name="email"> <br><br>
    CPF: <input type="text" name="cpf"> <br><br>
    Matricula: <input type="text" name="matricula"> <br><br>
    Estado: <input type="text" id="uf" name="uf" onchange="mostraInfo(this.value)"><br><br>
    Cidades: <select name="cidades" id="cidades"></select><br><br>

    <input type="button" name="op" value="Inserir Aluno" onclick="inserirAluno()">
  </form>
  <p id="resposta"></p>
</body>

</html>